+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|QUERY PLAN                                                                                                                                                                                                                                                                                  |
+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|Limit  (cost=305975.00..305975.02 rows=8 width=276)                                                                                                                                                                                                                                         |
|  CTE store_total                                                                                                                                                                                                                                                                           |
|    ->  Finalize GroupAggregate  (cost=213103.67..223112.19 rows=78795 width=137)                                                                                                                                                                                                           |
|          Group Key: customer.c_customer_id, customer.c_first_name, customer.c_last_name, date_dim.d_year                                                                                                                                                                                   |
|          ->  Gather Merge  (cost=213103.67..221503.47 rows=65662 width=105)                                                                                                                                                                                                                |
|                Workers Planned: 2                                                                                                                                                                                                                                                          |
|                ->  Partial GroupAggregate  (cost=212103.64..212924.42 rows=32831 width=105)                                                                                                                                                                                                |
|                      Group Key: customer.c_customer_id, customer.c_first_name, customer.c_last_name, date_dim.d_year                                                                                                                                                                       |
|                      ->  Sort  (cost=212103.64..212185.72 rows=32831 width=79)                                                                                                                                                                                                             |
|                            Sort Key: customer.c_customer_id, customer.c_first_name, customer.c_last_name, date_dim.d_year                                                                                                                                                                  |
|                            ->  Parallel Hash Join  (cost=203058.98..209640.86 rows=32831 width=79)                                                                                                                                                                                         |
|                                  Hash Cond: (customer.c_customer_sk = store_sales.ss_customer_sk)                                                                                                                                                                                          |
|                                  ->  Parallel Seq Scan on customer  (cost=0.00..6151.33 rows=78333 width=73)                                                                                                                                                                               |
|                                  ->  Parallel Hash  (cost=202629.73..202629.73 rows=34340 width=14)                                                                                                                                                                                        |
|                                        ->  Parallel Hash Join  (cost=1966.49..202629.73 rows=34340 width=14)                                                                                                                                                                               |
|                                              Hash Cond: (store_sales.ss_sold_date_sk = date_dim.d_date_sk)                                                                                                                                                                                 |
|                                              ->  Parallel Seq Scan on store_sales  (cost=0.00..191213.40 rows=3599740 width=14)                                                                                                                                                            |
|                                              ->  Parallel Hash  (cost=1961.12..1961.12 rows=429 width=8)                                                                                                                                                                                   |
|                                                    ->  Parallel Seq Scan on date_dim  (cost=0.00..1961.12 rows=429 width=8)                                                                                                                                                                |
|                                                          Filter: (d_year = ANY ('{2001,2002}'::integer[]))                                                                                                                                                                                 |
|  CTE web_total                                                                                                                                                                                                                                                                             |
|    ->  Finalize GroupAggregate  (cost=75344.47..78085.37 rows=21578 width=137)                                                                                                                                                                                                             |
|          Group Key: customer_1.c_customer_id, customer_1.c_first_name, customer_1.c_last_name, date_dim_1.d_year                                                                                                                                                                           |
|          ->  Gather Merge  (cost=75344.47..77644.81 rows=17982 width=105)                                                                                                                                                                                                                  |
|                Workers Planned: 2                                                                                                                                                                                                                                                          |
|                ->  Partial GroupAggregate  (cost=74344.45..74569.22 rows=8991 width=105)                                                                                                                                                                                                   |
|                      Group Key: customer_1.c_customer_id, customer_1.c_first_name, customer_1.c_last_name, date_dim_1.d_year                                                                                                                                                               |
|                      ->  Sort  (cost=74344.45..74366.92 rows=8991 width=79)                                                                                                                                                                                                                |
|                            Sort Key: customer_1.c_customer_id, customer_1.c_first_name, customer_1.c_last_name, date_dim_1.d_year                                                                                                                                                          |
|                            ->  Nested Loop  (cost=1966.91..73753.99 rows=8991 width=79)                                                                                                                                                                                                    |
|                                  ->  Parallel Hash Join  (cost=1966.49..69721.99 rows=8992 width=14)                                                                                                                                                                                       |
|                                        Hash Cond: (web_sales.ws_sold_date_sk = date_dim_1.d_date_sk)                                                                                                                                                                                       |
|                                        ->  Parallel Seq Scan on web_sales  (cost=0.00..65392.69 rows=900069 width=14)                                                                                                                                                                      |
|                                        ->  Parallel Hash  (cost=1961.12..1961.12 rows=429 width=8)                                                                                                                                                                                         |
|                                              ->  Parallel Seq Scan on date_dim date_dim_1  (cost=0.00..1961.12 rows=429 width=8)                                                                                                                                                           |
|                                                    Filter: (d_year = ANY ('{2001,2002}'::integer[]))                                                                                                                                                                                       |
|                                  ->  Index Scan using customer_pkey on customer customer_1  (cost=0.42..0.45 rows=1 width=73)                                                                                                                                                              |
|                                        Index Cond: (c_customer_sk = web_sales.ws_bill_customer_sk)                                                                                                                                                                                         |
|  ->  Sort  (cost=4777.44..4777.46 rows=8 width=276)                                                                                                                                                                                                                                        |
|        Sort Key: store_total_1.customer_first_name, store_total_1.customer_id, store_total_1.customer_last_name                                                                                                                                                                            |
|        ->  Hash Join  (cost=2804.20..4777.32 rows=8 width=276)                                                                                                                                                                                                                             |
|              Hash Cond: (store_total_1.customer_id = web_total_1.customer_id)                                                                                                                                                                                                              |
|              Join Filter: (CASE WHEN (web_total.year_total > '0'::numeric) THEN (web_total_1.year_total / web_total.year_total) ELSE NULL::numeric END > CASE WHEN (store_total.year_total > '0'::numeric) THEN (store_total_1.year_total / store_total.year_total) ELSE NULL::numeric END)|
|              ->  Hash Join  (cost=2317.34..4289.16 rows=46 width=508)                                                                                                                                                                                                                      |
|                    Hash Cond: (store_total.customer_id = store_total_1.customer_id)                                                                                                                                                                                                        |
|                    ->  CTE Scan on store_total  (cost=0.00..1969.88 rows=131 width=100)                                                                                                                                                                                                    |
|                          Filter: ((year_total > '0'::numeric) AND (year = 2001))                                                                                                                                                                                                           |
|                    ->  Hash  (cost=2316.45..2316.45 rows=71 width=408)                                                                                                                                                                                                                     |
|                          ->  Hash Join  (cost=539.90..2316.45 rows=71 width=408)                                                                                                                                                                                                           |
|                                Hash Cond: (store_total_1.customer_id = web_total.customer_id)                                                                                                                                                                                              |
|                                ->  CTE Scan on store_total store_total_1  (cost=0.00..1772.89 rows=394 width=308)                                                                                                                                                                          |
|                                      Filter: (year = 2002)                                                                                                                                                                                                                                 |
|                                ->  Hash  (cost=539.45..539.45 rows=36 width=100)                                                                                                                                                                                                           |
|                                      ->  CTE Scan on web_total  (cost=0.00..539.45 rows=36 width=100)                                                                                                                                                                                      |
|                                            Filter: ((year_total > '0'::numeric) AND (year = 2001))                                                                                                                                                                                         |
|              ->  Hash  (cost=485.50..485.50 rows=108 width=100)                                                                                                                                                                                                                            |
|                    ->  CTE Scan on web_total web_total_1  (cost=0.00..485.50 rows=108 width=100)                                                                                                                                                                                           |
|                          Filter: (year = 2002)                                                                                                                                                                                                                                             |
+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
