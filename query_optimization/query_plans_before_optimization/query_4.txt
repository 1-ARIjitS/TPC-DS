+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|QUERY PLAN                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        |
+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|Limit  (cost=5387390.24..6872113.48 rows=27 width=480)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |
|  CTE year_total                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  |
|    ->  Append  (cost=1300675.26..4614417.47 rows=14316754 width=255)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             |
|          ->  Finalize GroupAggregate  (cost=1300675.26..2477976.70 rows=7884824 width=255)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       |
|                Group Key: customer.c_customer_id, customer.c_first_name, customer.c_last_name, customer.c_preferred_cust_flag, customer.c_birth_country, customer.c_login, customer.c_email_address, date_dim.d_year                                                                                                                                                                                                                                                                                                                                                                                                                             |
|                ->  Gather Merge  (cost=1300675.26..2215149.25 rows=6570686 width=223)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |
|                      Workers Planned: 2                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          |
|                      ->  Partial GroupAggregate  (cost=1299675.24..1455729.03 rows=3285343 width=223)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |
|                            Group Key: customer.c_customer_id, customer.c_first_name, customer.c_last_name, customer.c_preferred_cust_flag, customer.c_birth_country, customer.c_login, customer.c_email_address, date_dim.d_year                                                                                                                                                                                                                                                                                                                                                                                                                 |
|                            ->  Sort  (cost=1299675.24..1307888.59 rows=3285343 width=213)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        |
|                                  Sort Key: customer.c_customer_id, customer.c_first_name, customer.c_last_name, customer.c_preferred_cust_flag, customer.c_birth_country, customer.c_login, customer.c_email_address, date_dim.d_year                                                                                                                                                                                                                                                                                                                                                                                                            |
|                                  ->  Parallel Hash Join  (cost=11587.32..270319.07 rows=3285343 width=213)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       |
|                                        Hash Cond: (store_sales.ss_customer_sk = customer.c_customer_sk)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          |
|                                        ->  Parallel Hash Join  (cost=2390.82..203054.07 rows=3436312 width=30)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
|                                              Hash Cond: (store_sales.ss_sold_date_sk = date_dim.d_date_sk)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       |
|                                              ->  Parallel Seq Scan on store_sales  (cost=0.00..191213.40 rows=3599740 width=30)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  |
|                                              ->  Parallel Hash  (cost=1853.70..1853.70 rows=42970 width=8)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       |
|                                                    ->  Parallel Seq Scan on date_dim  (cost=0.00..1853.70 rows=42970 width=8)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    |
|                                        ->  Parallel Hash  (cost=6151.33..6151.33 rows=78333 width=191)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           |
|                                              ->  Parallel Seq Scan on customer  (cost=0.00..6151.33 rows=78333 width=191)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        |
|          ->  Finalize GroupAggregate  (cost=732177.38..1370144.35 rows=4272701 width=255)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        |
|                Group Key: customer_1.c_customer_id, customer_1.c_first_name, customer_1.c_last_name, customer_1.c_preferred_cust_flag, customer_1.c_birth_country, customer_1.c_login, customer_1.c_email_address, date_dim_1.d_year                                                                                                                                                                                                                                                                                                                                                                                                             |
|                ->  Gather Merge  (cost=732177.38..1227720.99 rows=3560584 width=223)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             |
|                      Workers Planned: 2                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          |
|                      ->  Partial GroupAggregate  (cost=731177.36..815741.23 rows=1780292 width=223)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |
|                            Group Key: customer_1.c_customer_id, customer_1.c_first_name, customer_1.c_last_name, customer_1.c_preferred_cust_flag, customer_1.c_birth_country, customer_1.c_login, customer_1.c_email_address, date_dim_1.d_year                                                                                                                                                                                                                                                                                                                                                                                                 |
|                            ->  Sort  (cost=731177.36..735628.09 rows=1780292 width=216)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          |
|                                  Sort Key: customer_1.c_customer_id, customer_1.c_first_name, customer_1.c_last_name, customer_1.c_preferred_cust_flag, customer_1.c_birth_country, customer_1.c_login, customer_1.c_email_address, date_dim_1.d_year                                                                                                                                                                                                                                                                                                                                                                                            |
|                                  ->  Parallel Hash Join  (cost=11587.32..181251.27 rows=1780292 width=216)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       |
|                                        Hash Cond: (catalog_sales.cs_bill_customer_sk = customer_1.c_customer_sk)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 |
|                                        ->  Parallel Hash Join  (cost=2390.82..137312.77 rows=1790438 width=33)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
|                                              Hash Cond: (catalog_sales.cs_sold_date_sk = date_dim_1.d_date_sk)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
|                                              ->  Parallel Seq Scan on catalog_sales  (cost=0.00..130197.36 rows=1799736 width=33)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                |
|                                              ->  Parallel Hash  (cost=1853.70..1853.70 rows=42970 width=8)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       |
|                                                    ->  Parallel Seq Scan on date_dim date_dim_1  (cost=0.00..1853.70 rows=42970 width=8)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         |
|                                        ->  Parallel Hash  (cost=6151.33..6151.33 rows=78333 width=191)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           |
|                                              ->  Parallel Seq Scan on customer customer_1  (cost=0.00..6151.33 rows=78333 width=191)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             |
|          ->  Finalize GroupAggregate  (cost=372313.02..694712.64 rows=2159229 width=255)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         |
|                Group Key: customer_2.c_customer_id, customer_2.c_first_name, customer_2.c_last_name, customer_2.c_preferred_cust_flag, customer_2.c_birth_country, customer_2.c_login, customer_2.c_email_address, date_dim_2.d_year                                                                                                                                                                                                                                                                                                                                                                                                             |
|                ->  Gather Merge  (cost=372313.02..622738.33 rows=1799358 width=223)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |
|                      Workers Planned: 2                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          |
|                      ->  Partial GroupAggregate  (cost=371312.99..414047.74 rows=899679 width=223)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               |
|                            Group Key: customer_2.c_customer_id, customer_2.c_first_name, customer_2.c_last_name, customer_2.c_preferred_cust_flag, customer_2.c_birth_country, customer_2.c_login, customer_2.c_email_address, date_dim_2.d_year                                                                                                                                                                                                                                                                                                                                                                                                 |
|                            ->  Sort  (cost=371312.99..373562.19 rows=899679 width=216)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           |
|                                  Sort Key: customer_2.c_customer_id, customer_2.c_first_name, customer_2.c_last_name, customer_2.c_preferred_cust_flag, customer_2.c_birth_country, customer_2.c_login, customer_2.c_email_address, date_dim_2.d_year                                                                                                                                                                                                                                                                                                                                                                                            |
|                                  ->  Parallel Hash Join  (cost=11587.32..97833.01 rows=899679 width=216)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         |
|                                        Hash Cond: (web_sales.ws_bill_customer_sk = customer_2.c_customer_sk)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     |
|                                        ->  Parallel Hash Join  (cost=2390.82..70146.33 rows=899859 width=33)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     |
|                                              Hash Cond: (web_sales.ws_sold_date_sk = date_dim_2.d_date_sk)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       |
|                                              ->  Parallel Seq Scan on web_sales  (cost=0.00..65392.69 rows=900069 width=33)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      |
|                                              ->  Parallel Hash  (cost=1853.70..1853.70 rows=42970 width=8)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       |
|                                                    ->  Parallel Seq Scan on date_dim date_dim_2  (cost=0.00..1853.70 rows=42970 width=8)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         |
|                                        ->  Parallel Hash  (cost=6151.33..6151.33 rows=78333 width=191)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           |
|                                              ->  Parallel Seq Scan on customer customer_2  (cost=0.00..6151.33 rows=78333 width=191)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             |
|  ->  Incremental Sort  (cost=772972.78..2257696.01 rows=27 width=480)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |
|        Sort Key: t_s_secyear.customer_id, t_s_secyear.customer_first_name, t_s_secyear.customer_last_name, t_s_secyear.customer_email_address                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    |
|        Presorted Key: t_s_secyear.customer_id                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    |
|        ->  Nested Loop  (cost=715868.07..2257694.79 rows=27 width=480)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           |
|              Join Filter: ((t_s_firstyear.customer_id = t_s_secyear.customer_id) AND (CASE WHEN (t_c_firstyear.year_total > '0'::numeric) THEN (t_c_secyear.year_total / t_c_firstyear.year_total) ELSE NULL::numeric END > CASE WHEN (t_s_firstyear.year_total > '0'::numeric) THEN (t_s_secyear.year_total / t_s_firstyear.year_total) ELSE NULL::numeric END) AND (CASE WHEN (t_c_firstyear.year_total > '0'::numeric) THEN (t_c_secyear.year_total / t_c_firstyear.year_total) ELSE NULL::numeric END > CASE WHEN (t_w_firstyear.year_total > '0'::numeric) THEN (t_w_secyear.year_total / t_w_firstyear.year_total) ELSE NULL::numeric END))|
|              ->  Merge Join  (cost=715868.07..715879.48 rows=641 width=612)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      |
|                    Merge Cond: (t_s_secyear.customer_id = t_c_secyear.customer_id)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               |
|                    ->  Sort  (cost=357934.04..357934.93 rows=358 width=512)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      |
|                          Sort Key: t_s_secyear.customer_id                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       |
|                          ->  CTE Scan on year_total t_s_secyear  (cost=0.00..357918.85 rows=358 width=512)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       |
|                                Filter: ((sale_type = 's'::text) AND (dyear = 2002))                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |
|                    ->  Sort  (cost=357934.04..357934.93 rows=358 width=100)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      |
|                          Sort Key: t_c_secyear.customer_id                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       |
|                          ->  CTE Scan on year_total t_c_secyear  (cost=0.00..357918.85 rows=358 width=100)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       |
|                                Filter: ((sale_type = 'c'::text) AND (dyear = 2002))                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |
|              ->  Materialize  (cost=0.00..1539892.51 rows=75 width=400)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          |
|                    ->  Nested Loop  (cost=0.00..1539892.13 rows=75 width=400)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    |
|                          Join Filter: (t_s_firstyear.customer_id = t_w_secyear.customer_id)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      |
|                          ->  Nested Loop  (cost=0.00..1181638.55 rows=42 width=300)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |
|                                Join Filter: (t_s_firstyear.customer_id = t_w_firstyear.customer_id)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |
|                                ->  Nested Loop  (cost=0.00..787738.90 rows=71 width=200)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         |
|                                      Join Filter: (t_s_firstyear.customer_id = t_c_firstyear.customer_id)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        |
|                                      ->  CTE Scan on year_total t_s_firstyear  (cost=0.00..393710.74 rows=119 width=100)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         |
|                                            Filter: ((year_total > '0'::numeric) AND (sale_type = 's'::text) AND (dyear = 2001))                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  |
|                                      ->  CTE Scan on year_total t_c_firstyear  (cost=0.00..393710.74 rows=119 width=100)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         |
|                                            Filter: ((year_total > '0'::numeric) AND (sale_type = 'c'::text) AND (dyear = 2001))                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  |
|                                ->  CTE Scan on year_total t_w_firstyear  (cost=0.00..393710.74 rows=119 width=100)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               |
|                                      Filter: ((year_total > '0'::numeric) AND (sale_type = 'w'::text) AND (dyear = 2001))                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        |
|                          ->  CTE Scan on year_total t_w_secyear  (cost=0.00..357918.85 rows=358 width=100)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       |
|                                Filter: ((sale_type = 'w'::text) AND (dyear = 2002))                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |
+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
